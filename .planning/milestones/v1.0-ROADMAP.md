# Milestone v1.0: Fold 1 Baseline Evaluation

**Status:** ✅ SHIPPED 2026-01-19
**Phases:** 1-5
**Total Plans:** 3 (documented in Phase 5)

## Overview

Complete fold 1 evaluation of 10 perturbation prediction models across 9 cell lines with consistent TopKEvaluator metrics. Establishes baseline performance rankings for future ensemble development.

## Phases

### Phase 1: TranSiGen Completion

**Goal**: Run missing TranSiGen MDAMB231 fold 1
**Depends on**: None
**Plans**: 0 (executed outside GSD tracking)

**Deliverables:**
- [x] TranSiGen MDAMB231 fold 1 trained
- [x] Results added to CSV

---

### Phase 2: Biolord Metric Extraction

**Goal**: Extract top-k R² metrics from trained Biolord models
**Depends on**: None
**Plans**: 0 (executed outside GSD tracking)

**Deliverables:**
- [x] Extract metrics from Biolord logs/checkpoints for all 9 cells
- [x] Add to results CSV with standardized naming

---

### Phase 3: PDGrapher Evaluation

**Goal**: Run PDGrapher with proper DE metrics for all cell lines
**Depends on**: None
**Plans**: 0 (executed outside GSD tracking)

**Deliverables:**
- [x] A549, A375, BT20, HELA, HT29 forward models trained
- [x] MCF7, MDAMB231, PC3, VCAP complete
- [x] All results extracted with TopKEvaluator

**Notes**: PDGrapher requires separate forward/backward model training. Focus on forward (diseased→treated) for DE prediction.

---

### Phase 4: Results Consolidation

**Goal**: Merge all results into final CSV with standardized naming
**Depends on**: Phases 1, 2, 3
**Plans**: 0 (executed outside GSD tracking)

**Deliverables:**
- [x] All 90 model×cell combinations in CSV (10 models × 9 cells)
- [x] Naming verified (PascalCase)
- [x] Metrics verified against TopKEvaluator standard

---

### Phase 5: CheMoE PDGrapher Adaptation

**Goal**: Adapt original CheMoE model to work with PDGrapher's 10,716-gene data
**Depends on**: None (parallel with Phases 1-4)
**Plans**: 3 plans

Plans:
- [x] 05-01-PLAN.md — Create CheMoE_PDG model (model.py, __init__.py)
- [x] 05-02-PLAN.md — Create training script (train_chemoe_pdg.py)
- [x] 05-03-PLAN.md — Train all 9 cell lines and collect results

**Deliverables:**
- [x] CheMoE wrapper adapted for 10,716 genes (5.5M parameters)
- [x] Training script `train_chemoe_pdg.py` created
- [x] All 9 cell lines trained (fold 0)
- [x] Results extracted with TopKEvaluator

**Results**: Mean R² Top-20: 0.6555 (fold 0)

**Notes**:
- Original CheMoE uses 978 genes (L1000), adapted to 10,716
- MoE architecture: 4 experts, top-k=2 sparse routing
- Input: SMILES (KPGT or Morgan FP), cell embedding, basal expression → DE prediction
- Trained on fold 0; other baselines use fold 1

---

## Milestone Summary

**Key Decisions:**

| Decision | Rationale |
|----------|-----------|
| mol-encoder-dual | Support KPGT (2304) and Morgan (1024) for flexibility |
| gene-aware-experts | Shared MLP + gene embeddings for parameter efficiency |
| sparse-gating | Top-k=2 with softmax over selected matches CheMoE original |
| mse-plus-aux-loss | MSE + 0.01 * load balancing loss for expert diversity |
| fold-0-training | Used fold 0 for CheMoE (plan specified) |

**Final Model Rankings (Mean R² Top-20):**

| Rank | Model | Score |
|------|-------|-------|
| 1 | Biolord | 0.7957 |
| 2 | MultiDCP | 0.7694 |
| 3 | PDGrapher | 0.7689 |
| 4 | MultiDCP_CheMoE | 0.7601 |
| 5 | ChemCPA | 0.7460 |
| 6 | TranSiGen_MoE_Sparse | 0.7454 |
| 7 | TranSiGen | 0.6720 |
| 8 | CheMoE_PDG* | 0.6555 |
| 9 | TranSiGen_MoE_Balanced | 0.6013 |
| 10 | scGen | 0.5701 |

*CheMoE_PDG trained on fold 0

**Issues Resolved:**
- NumPy 2.x/1.x pickle compatibility (upgraded mdcp_env)
- SciPy binary incompatibility (reinstalled)
- GPU OOM during parallel training (sequential restart)

**Technical Debt:**
- CheMoE_PDG trained on fold 0, not fold 1 (consider retraining for proper comparison)

---

*For current project status, see .planning/ROADMAP.md*
